<project name="UT3WebAdmin" default="build">

  <dirname property="ut3dir" file="${basedir}"/>
  <tstamp>
    <format property="distfile.tstamp" pattern="yyyy-MM-dd" />
  </tstamp>

  <target name="clean" description="Clean the distribution and build directories">
    <delete dir="build" />
    <delete dir="dist" />
    <delete file="${ut3dir}/UTGame/CookedPC/WebAdmin.u" />
  </target>

  <target name="build" description="Build the UT3 WebAdmin">
    <exec executable="${ut3dir}/Development/Src/WebAdmin/settimestamp.cmd" dir="${ut3dir}/Development/Src/WebAdmin" />
    <exec executable="ut3.com" dir="${ut3dir}/binaries/" failonerror="true" resolveexecutable="true">
      <arg value="make" />
      <arg value="-unattended" />
      <arg value="-nohomedir" />
    </exec>
  </target>

  <target name="-dist-copy-files">
    <copy todir="build">
        <fileset dir="${basedir}">
            <include name="*.URL" />
        </fileset>
    </copy>
  
    <mkdir dir="build/Web"/>
    <copy todir="build/Web">
      <fileset dir="${ut3dir}/Web"/>
    </copy>
    
    <mkdir dir="build/UTGame/CookedPC"/>
    <copy todir="build/UTGame/CookedPC">
      <fileset dir="${ut3dir}/UTGame/CookedPC">
        <include name="WebAdmin.u" />
      </fileset>
    </copy>

    <mkdir dir="build/UTGame/Config"/>
    <copy todir="build/UTGame/Config">
      <fileset dir="${ut3dir}/UTGame/Config">
        <include name="DefaultWebAdmin.ini" />
      </fileset>
    </copy>
  </target>

  <target name="dist" depends="clean,build,-dist-copy-files" description="Build a release package">
    <mkdir dir="dist" />
    <zip destfile="dist/WebAdmin-${distfile.tstamp}.zip" basedir="build" />
  </target>

  <target name="dist-dev" depends="clean,build,-dist-copy-files" description="Build a developer release package">
    <mkdir dir="build/Development/Src"/>
    <copy todir="build/Development/Src">
      <fileset dir="${ut3dir}/Development/Src">
        <include name="WebAdmin/**" />
        <exclude name="**/*_old/**" />
        <exclude name="**/*.user" />
        <exclude name="**/*.cmd" />
      </fileset>
    </copy>
    <mkdir dir="dist" />
    <zip destfile="dist/WebAdmin_dev-${distfile.tstamp}.zip" basedir="build" />
  </target>
  
</project>
