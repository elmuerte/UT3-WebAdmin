<!-- #include file="header.inc" -->

<div id="content">

<form method="post" action="<%page.fulluri%>">
<fieldset>
<legend>Gametype selection</legend>
    <select id="gametype" name="gametype">
    <%gametypes%>
    </select>
    <button type="submit" id="btnselect">edit map cycle</button>
</fieldset>
</form>

<form method="post" action="<%page.fulluri%>">
<fieldset>
<legend>Map cycle for <em><%editgametype.name%></em></legend>
<input type="hidden" name="gametype" value="<%editgametype.class%>" />

<div>
<table class="noborder">
<thead>
<tr>
    <th>Available Maps</th>
    <th>Map Cycle</th>
    <th></th>
</tr>
</thead>

<tbody id="noscript">
<tr>
    <td><textarea rows="15" cols="30" id="allmaps" readonly="readonly"><%allmaps.plain%></textarea></td>
    <td><textarea rows="15" cols="30" name="mapcycle" id="mapcycle"><%cycle.plain%></textarea></td>
    <td></td>
</tr>
<tr>
    <td colspan="3"><em>Note:</em> you get the best map list editing experiance in a JavaScript capable browser. Enter one map per line.</td>
</tr>
</tbody>

<tbody id="jsmaplist" display="none">
<tr>
    <td><ul id="jsallmaps"></ul></td>
    <td><ol id="jsmapcycle"></ol></td>
    <td><ul id="jsgarbage"><li class="garbagebin"></li></ul></td>
</tr>
<tr>
    <td colspan="3"><em>Note:</em> drag and drop items to add and move items in the map cycle.</td>
</tr>
</tbody>
</table>

</div>

<button type="submit" name="action" value="save" id="btnsave">save map cycle</button>
</fieldset>
</form>

<script type="text/javascript">
//<![CDATA[

$(document).ready(function() {
    $('#noscript').hide();
    $('#jsmaplist').show();
    
    allmaps = $('#allmaps').val().split("\n");
    jsallmaps = $('#jsallmaps');
    for (i = 0; i < allmaps.length; i++)
    {
        str = jQuery.trim(allmaps[i]);
        if (str.length > 0)
        {
            jsallmaps.append('<li>'+str+'</li>');
        }
    }
    mapcycle = $('#mapcycle').val().split("\n");
    
    jsmapcycle = $('#jsmapcycle');
    for (i = 0; i < mapcycle.length; i++)
    {
        str = jQuery.trim(mapcycle[i]);
        if (str.length > 0)
        {
            jsmapcycle.append('<li>'+str+'</li>');
        }
    }
    $('#jsgarbage').sortable({
        axis: "x", 
        containment: "parent"
    });
    jsmapcycle.sortable({ 
        //axis: "y", 
        placeholder: "sorting", 
        //containment: "parent",
        opacity: 0.5,
        connectWith: ['#jsgarbage'],
        start: function(ev, ui) {
            $(ui.helper).addClass('dragging');
        },
        stop: function(ev, ui) {
            $(ui.helper).removeClass('dragging');
            $(ui.placeholder).remove();
        }
    });
    $('#jsallmaps li').draggable({
        helper: 'clone',
        zIndex: 100,
        start: function(ev, ui) {
            $(ui.helper).addClass('dragging');
        },
        stop: function(ev, ui) {
            $(ui.helper).removeClass('dragging');
        }
    });
    $('#jsmapcycle').parent().droppable({
        accept: "li",
        activeClass: "droppable",
        drop: function(ev, ui) {
            jsmapcycle.append($(ui.draggable).clone());
            jsmapcycle.sortable("refresh");
            jsmapcycle.sortable("refreshPositions");
        }
	});
});

//]]>
</script>

</div>

<!-- #include file="navigation.inc" -->
<!-- #include file="footer.inc" -->
