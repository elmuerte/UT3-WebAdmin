<!-- #include file="header.inc" -->

<div id="content">

<div id="chatlog">
<%chat.log%>
</div>

<div id="chat">
<form id="chatform" action="<%page.fulluri%>#chat" method="POST">
<input type="text" id="chatmessage" name="message" value="" size="80"><button type="submit">say</button>
</form>
<script type="text/javascript">
$(document).ready(function(){
    $('#chatmessage').focus();
    setTimeout('getMessages()', <%chat.refresh%>);
});

$('#chatform').submit(function() {
    $.ajax({
        type: "POST",
        url: '<%page.fulluri%>/data',
        data: {ajax: 1, message: $('#chatmessage').val()},
        success: chatMessage,
        error: ajaxError
    });
    $('#chatmessage').val('');
    return false;
});

function getMessages() {
    $.ajax({
        type: "POST",
        url: '<%page.fulluri%>/data',
        data: {ajax: 1},
        success: chatMessage,
        error: ajaxError
    });
    setTimeout('getMessages()', <%chat.refresh%>);
}

function chatMessage(data, textStatus) {
    cnt = $('.chatmessage').size()-1;
    $('#chatlog').append(data);
    x = $('.chatmessage:gt('+cnt+')');
    x.hide();
    x.fadeIn("fast");
}

function ajaxError(XMLHttpRequest, textStatus, errorThrown) {
    if (XMLHttpRequest.status == 403) {
        document.location = '<%page.fulluri%>';
    }
}
</script>
</div>


</div>

<!-- #include file="navigation.inc" -->
<!-- #include file="footer.inc" -->
